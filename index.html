<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Scan Sampah AI</title>

<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/mobilenet"></script>

<style>
body{
    font-family: Arial, sans-serif;
    background:#e0f2f1;
    text-align:center;
}
.container{
    background:white;
    max-width:420px;
    margin:30px auto;
    padding:20px;
    border-radius:12px;
    box-shadow:0 5px 15px rgba(0,0,0,0.2);
}
video{
    width:100%;
    border-radius:10px;
    margin-top:10px;
}
button{
    margin-top:15px;
    padding:12px 20px;
    border:none;
    background:#009688;
    color:white;
    font-size:16px;
    border-radius:6px;
}
.hidden{display:none;}
#hasil{margin-top:15px;font-size:18px;}
</style>
</head>

<body>

<div class="container">
    <h1>‚ôªÔ∏è Scan Sampah AI</h1>
    <p>Pilah sampah organik & anorganik</p>

    <button id="toggleBtn" onclick="toggleScan()">üì∑ Buka Scan</button>

    <div id="cameraArea" class="hidden">
        <video id="video" autoplay playsinline></video>
        <canvas id="canvas" class="hidden"></canvas>
        <button id="scanBtn" onclick="scanSampah()" disabled>üîç Scan Sampah</button>
        <div id="hasil">üîí Scan belum dibuka</div>
    </div>
</div>

<script>
const video = document.getElementById("video");
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
const hasil = document.getElementById("hasil");
const cameraArea = document.getElementById("cameraArea");
const toggleBtn = document.getElementById("toggleBtn");
const scanBtn = document.getElementById("scanBtn");

let model;
let stream = null;

// ================= PRELOAD AI SAAT HALAMAN DIBUKA =================
window.addEventListener("load", async () => {
    hasil.innerHTML = "‚è≥ Menyiapkan AI...";
    model = await mobilenet.load();
    hasil.innerHTML = "‚úÖ AI siap. Silahkan Scan.";
});

// ================= TOGGLE SCAN =================
async function toggleScan(){
    if(stream === null){
        cameraArea.classList.remove("hidden");
        toggleBtn.disabled = true;
        hasil.innerHTML = "‚è≥ Mengaktifkan kamera...";

        try{
            stream = await navigator.mediaDevices.getUserMedia({
                video:{ facingMode:"environment" }
            });

            video.srcObject = stream;

            await new Promise(r => video.onloadedmetadata = r);

            hasil.innerHTML = "‚úÖ Kamera aktif.  Menunggu AI siap";
            toggleBtn.innerHTML = "‚ùå Tutup Scan";
            scanBtn.disabled = false;
            toggleBtn.disabled = false;

        }catch(err){
            hasil.innerHTML = "‚ùå Gagal membuka kamera";
            toggleBtn.disabled = false;
        }

    }else{
        stream.getTracks().forEach(t => t.stop());
        video.srcObject = null;
        stream = null;

        cameraArea.classList.add("hidden");
        toggleBtn.innerHTML = "üì∑ Buka Scan";
        hasil.innerHTML = "üîí Scan ditutup";
        scanBtn.disabled = true;
    }
}

// ================= SCAN SAMPAH =================
async function scanSampah(){
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    ctx.drawImage(video,0,0);

    const pred = await model.classify(canvas);
    const objek = pred[0].className.toLowerCase();
    const conf = (pred[0].probability*100).toFixed(2);

    if(
        objek.includes("banana")||
        objek.includes("apple")||
        objek.includes("orange")||
        objek.includes("food")||
        objek.includes("leaf")||
        objek.includes("plant")||
        objek.includes("fruit")||
        objek.includes("vegetable")
    ){
        hasil.innerHTML = `üåø <b>ORGANIK</b><br>${objek}<br>${conf}%`;
        hasil.style.color="green";
    }else{
        hasil.innerHTML = `‚ôªÔ∏è <b>ANORGANIK</b><br>${objek}<br>${conf}%`;
        hasil.style.color="blue";
    }
}
</script>

</body>
</html>